#!/usr/bin/env python

import os
import sys

if getattr(sys, 'frozen', False):
    # Running under pyinstaller
    from ozy.__main__ import app_main

    app_main(sys.argv[0], sys.argv[1:], True)
else:
    # Running in dev mode
    OZY_DIR = os.path.realpath(os.path.join(os.path.dirname(os.path.realpath(__file__)), '..'))

    OZY_PYTHON = os.path.join(OZY_DIR, '.venv', 'bin', 'python3.7')
    os.environ['PYTHONPATH'] = OZY_DIR
    # We pass argv[0] again to the python executable: if we don't use OZY_PYTHON as argv[0], virtualenv flips out.
    # As the ozy script needs to know the name it was invoked as, we pass all of argv again.
    # i.e. if invoked as "nomad --version" we will "path/to/python path/to/ozy/__main__.py nomad --version
    os.execve(OZY_PYTHON, [OZY_PYTHON, os.path.join(OZY_DIR, 'ozy', '__main__.py')] + sys.argv, os.environ)
